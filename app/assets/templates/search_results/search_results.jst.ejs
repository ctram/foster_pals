<div class='explain explain-my-pets animated well slideInLeft'>
	Check status of your requests to foster your pet.
	<br>
	Add more pets to your roster.
	<br>
	<b>Click for next tip.</b>
</div>

<div class='explain explain-reservations animated hidden well'>
	Check on reservation requests made by other FosterPals, requesting you to foster their pets.
	<br>
	Confirm or deny these requests.
	<br>
	<b>Click for next tip.</b>
</div>

<div class='explain explain-search-results-profiles animated hidden well'>
	Go to a FosterPal's profile page to request a reservation for your FosterPal to foster your animals.
	<br>
	<b>Click to exit tips.</b>
</div>


<div class='profile-preview-hook'></div>

<div class='user-items animated fadeInLeft'></div>

<div class='error-msg-hook'></div>

<div class='map-hook animated fadeInRight'></div>

<!-- MODAL ===============================================================  -->

<div class="modal fade in slacker-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="false">
	<div class="modal-dialog modal-slacker">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
				<h4 class="modal-title" id="myLargeModalLabel">
          The Map.
          <span class="text-muted">Find Other FosterPals.</span>
        </h4>
			</div>
			<div class="modal-body">
				<div class="text-center modal-text">
  				<p class='map-modal-text'>
            Enter a location in the search bar to check for FosterPals nearby. Follow a link from <b>Search Results</b> to reach a FosterPal's profile page, where you can submit a request to have your pets fostered.
          </p>

          <p class='map-modal-text'>
            Go to <b>My Pets</b> to check on the reservation status of your pets and to add pets to your roster.
          </p>

          <p class='map-modal-text'>
            Go to <b>Reservation Requests</b> to see requests made by other FosterPals, asking you to foster a pet.
          </p>

   				<p>
            <a class="btn btn-default modal-off" href="" data-toggle='modal' role="button">
              Go To The Map!
            </a>
          </p>
  			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div>
<!-- END MODAL =========================================================== -->
<script>
  $(function () {
		// TODO: write up tour maps page.

		function removeExplanationDiv ($div) {
			debugger
			if ($div.classList[0] === 'explain') {
				// div is an explanation
				$div.removeClass('slideInRight').addClass('fadeOutDown');
				setTimeout(function ($div) {
					$div.remove();
				}, 3000);
			} else {
				// div is a link
				$div.removeClass('nav-link-pop');
			}
		}

		function tour () {
			// explanation divs
			var explanationDivs = [
				$('.explain-my-pets')[0],
				$('.explain-reservations')[0],
				$('.explain-search-results-profiles')[0]
			];

			// link divs that the explanations are referring to
			var highlightedLinks = [
				$('#animal-roster-link'),
				$('#schedule-manager-link'),
				$('.go-to-user-profile').first()
			];

			var idx = 1;
			var $currentExplanation;
			var $previousExplanation = explanationDivs[0];
			var $currentLink;
			var $previousLink = highlightedLinks[0];
			$previousLink.addClass('nav-link-pop');
			var queueRemoval = [explanationDivs.shift()];

			$('.explain').on('click', function (event) {
				debugger
				if (idx < 3) {
					$currentExplanation = $(explanationDivs[idx]);
					$currentLink = highlightedLinks[idx];
					$currentExplanation.removeClass('hidden').addClass('slideInLeft');
					$currentLink.addClass('nav-link-pop');
					queueRemoval.push($currentLink)
				}

				if (queueRemoval[0] === null) {
					queue.shift();
				} else {
					removeExplanationDiv(queueRemoval.shift());
				}

				/*
				if ($previousExplanation !== undefined) {
					$previousExplanation.removeClass('slideInLeft').addClass('fadeOutDown');
					$previousLink.removeClass('nav-link-pop');
					// FIXME: second div is not fading - has to do with the setTimeout()
					setTimeout(function () {
						$previousExplanation.remove();
						$previousExplanation = $currentExplanation;
						$previousLink = $currentLink;
					}, 1500);
				}
				*/
				idx++;
			});

			/*
			for (var i = 0; i < explanationDivs.length; i++) {
				if (i !== 0) {
					$explanationDiv.removeClass('slideInLeft').addClass('fadeOut');
					$previousLink.removeClass('.nav-link-pop');
					setTimeOut(function () {
						$explainDiv.remove();
					}, 3000);
				}

				var $explanationDiv = explanationDivs[i];
				var $highlightedLink = highlightedLinks[i];

				var $previousDiv  = $explanationDiv.removeClass('hidden').addClass('slideInLeft');
				var $previousLink = $highlightedLink.addClass('.nav-link-pop');
			}
			*/
		}

		tour();

		if (FosterPals.mapFirstVisit) {
	    $('.modal').modal();

	    $('a.modal-off').on('click', function (event) {
	      event.preventDefault();
	      $('.modal').modal('hide');
	    });
			FosterPals.mapFirstVisit = false;
		}
  });
</script>
